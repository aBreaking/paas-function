{
  "size":0,
  "query":{
    "bool":{
      "must":[
        {
          "range":{
            "@timestamp":{
              "gte": "2019-07-21T00:23:47.473Z",
              "lt": "2019-07-21T24:30:47.473Z"
            }
          }
        }
      ],
      "must_not":[
        {
          "terms":{
            "retMsg":["c1","c2"]
          }
        },
        {
          "term":{
            "retCode":"123"
          }
        },
        {
          "regexp":{
            "endPoint":".*mytest.*"
          }
        }
      ]
    }
  },

  "aggs":{
    "srvName":{
      "terms":{
        "size":10,
        "field":"srvName",
        "order":{
          "_count":"desc"
        }
      },
      "aggs":{
        "retCode":{
          "terms":{
            "field":"retCode"
          },
          "aggs":{
            "retMsg":{
              "terms":{
                "field":"retMsg"
              }
            }
          }
        }
      }
    }
  }

}