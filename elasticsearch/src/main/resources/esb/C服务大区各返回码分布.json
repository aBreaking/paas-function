{
  "size":0,
  "query":{
    "bool":{
      "must":[
        {
          "range":{
            "@timestamp":{
              "gte": "2019-09-01T00:00:00.000Z",
              "lt": "2019-09-01T00:10:00.000Z"
            }
          }
        },
        {
          "regexp":{
            "endPoint":".*TEMPLATE.*"
          }
        },
        {
          "terms":{
            "clientIP":["10.113.228.130","10.113.158.84"]
          }
        }
      ]
    }
  },
  "aggs":{
    "srvNameAgg":{
      "terms":{
        "field":"srvName",
        "order":{
          "_count":"desc"
        }
      },
      "aggs":{
        "retCodeAgg":{
          "terms":{
            "field":"retCode"
          },
          "aggs":{
            "dbIdAgg":{
              "terms":{
                "field":"dbId"
              },
              "aggs":{
                "executeTimeAvg":{
                  "avg":{
                    "field":"executeTime"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}